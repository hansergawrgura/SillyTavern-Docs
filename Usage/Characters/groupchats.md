---
order: character-20
route: /usage/core-concepts/groupchats
---

# 💬 群聊功能

## 🤖 回复顺序策略

决定群聊中角色回复的选定方式。

### ✋ 手动

您可以从菜单中选择或使用 `/trigger` 命令手动选择回复的角色。选定的群成员将是唯一回复者。用户消息不会自动触发任何回复。使用空用户输入触发生成时，将随机触发一位未静音的群成员进行回复。

### 🔄 自然顺序

尝试模拟真实人类对话的流程。算法如下：

1.  从上一条聊天消息中提取群成员名称的提及（Mentions）。

    > 只有完整单词才会被识别为提及！如果您的角色名为“Misaka Mikoto”，他们只会对“Misaka”或“Mikoto”作出反应，而永远不会对“Misa”、“Railgun”等作出反应。
    >
    > 除非启用了“允许自我回复”设置，否则角色不会对自己消息中提及自己名称作出回复！

2.  角色通过“健谈度”（Talkativeness）因素激活。

    健谈度定义了角色在未被提及时主动发言的频率。请在角色编辑器的“高级定义”界面调整此值。滑块值为**0% / 害羞**（除非被提及，否则从不发言）到**100% / 健谈**（总是回复）的线性比例。新角色的默认值为50%的几率。

3.  随机选择一名角色。

    如果前几步均未激活任何角色，则将忽略所有其他条件，随机选择一名发言者。

### 📜 列表顺序

角色根据其在群成员列表中的呈现顺序依次被选定回复。不适用其他规则。

### 🎱 轮盘顺序

激活一名自上次用户消息以来尚未发言的随机角色。如果所有角色都已发言，则随机选择一名，直到下一次用户消息。

## 🧠 群生成处理模式

此设置决定如何处理群聊成员的角色信息。无论选择何种模式，群聊历史记录始终在所有成员之间共享。

### 🔄 切换角色卡

**默认模式**。每次生成消息时，上下文中仅包含当前活跃发言者的角色卡信息。

### 🧩 合并角色卡

将所有群成员的信息按其列表顺序合并到一个联合提示（joint prompt）中。这在需要避免大幅更改上下文的情况下（例如使用 llama.cpp 的提示缓存时）会有所帮助。

此模式有两种子模式（必须选择一种）：

*   `包含静音成员` - 静音角色将始终包含在联合提示中。
*   `排除静音成员` - 静音角色如果并非当前发言者，则不会被包含。

以下字段会被合并：

1.  描述（Description）
2.  场景（Scenario），如果未在聊天中覆盖
3.  人格（Personality）
4.  消息示例（Message examples）
5.  角色笔记 / 深度提示（Character notes / Depth prompts）

!!! [warning] 重要提示！
请注意，由于典型角色卡的结构方式，使用此模式可能导致意外行为，包括但不限于：角色对自身感到困惑、人格融合、特质不确定等。
!!!

### 🧩 合并前缀与后缀

当选择“合并角色卡”时，所有相应字段将被合并在一起。这意味着在最终的提示中，所有角色描述将合并成一大段文本。如果您希望这些字段是分开的，可以定义前缀（prefix）和/或后缀（suffix）。

这些选项支持普通宏（macros），并且会将 `{{char}}` 替换为相关角色的名称，将 `<FIELDNAME>` 替换为部分的名称（例如：description, personality, scenario 等）。

## ⚙️ 其他群聊菜单选项

### 🔇 静音角色

群聊菜单中角色头像旁划有斜线的语音气泡图标可禁用或启用特定角色在聊天中的回复。

### 🗣️ 强制发言

群聊菜单中角色头像旁的语音气泡图标将触发特定角色的回复，绕过回复顺序策略。即使该群成员被静音，此功能也会生效。

### 🤖 自动模式

启用自动模式后，群聊将遵循回复顺序并在无需用户交互的情况下触发消息生成。在上一位选定的角色发送其消息后，经过 5 秒延迟会触发下一个自动模式回合。当用户开始在发送消息文本区域中输入时，自动模式将被禁用，但已排队的生成不会自动停止。

### 🔁 允许自我回复

当选择“自然顺序”时，如果角色因被自我提及而触发，将允许其在每回合中连续回复（即上一条消息的发送者可以再次回复）。对列表顺序无效。

### 📝 群聊场景覆盖

所有群成员将使用此处输入的场景文本，而非其角色卡中指定的场景。分支聊天从其父级继承场景覆盖设置，之后可以单独更改。

### 👀 查看角色定义

点击群聊菜单中头像旁的角色卡图标可快速导航至通常的角色定义界面。在此处进行的任何更改都将保存至角色卡本身。

要返回群聊，请点击群组名称标题链接。

### 👥 成员管理

您现有的任何角色都可以在群聊中添加、移除、静音或重新排序。默认情况下，新成员会添加到群成员列表的顶部，之后可以使用箭头图标重新排序。

### 🪟 群聊菜单弹出窗口

点击“当前成员”字段旁的图标可激活群聊菜单弹出窗口。启用用户设置中的 MovingUI 后，可以调整此菜单的大小并将其拖动到界面内的任何位置，其功能与常规群聊菜单完全相同。